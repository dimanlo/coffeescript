// Generated by CoffeeScript 2.7.0
(function() {
  var PomodoroTimer;

  PomodoroTimer = class PomodoroTimer {
    constructor(workDuration = 10, breakDuration = 5) {
      this.workDuration = workDuration;
      this.breakDuration = breakDuration;
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
      this.timeLeft = this.workDuration;
      this.isRunning = false;
      this.isWorkSession = true;
      this.intervalId = null;
      this.completedSessions = 0;
      
      // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ DOM
      this.elements = {
        display: document.getElementById('timer-display'),
        sessionType: document.getElementById('session-type'),
        sessionCounter: document.getElementById('session-counter'),
        sessionHistory: document.getElementById('session-history'),
        progressBar: document.getElementById('progress-bar'),
        startButton: document.getElementById('start-button'),
        pauseButton: document.getElementById('pause-button'),
        resetButton: document.getElementById('reset-button'),
        notificationSound: document.getElementById('notification-sound')
      };
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ LocalStorage
      this.loadFromStorage();
      
      // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
      this.bindEvents();
      
      // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
      this.updateDisplay();
    }

    bindEvents() {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç—Ä–µ–ª–æ—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
      this.elements.startButton.addEventListener('click', () => {
        return this.start();
      });
      this.elements.pauseButton.addEventListener('click', () => {
        return this.pause();
      });
      return this.elements.resetButton.addEventListener('click', () => {
        return this.reset();
      });
    }

    start() {
      if (this.isRunning) {
        return;
      }
      this.isRunning = true;
      this.updateButtons();
      return this.intervalId = setInterval(() => {
        this.timeLeft -= 1;
        this.updateDisplay();
        if (this.timeLeft <= 0) {
          return this.completeSession();
        }
      }, 1000);
    }

    pause() {
      if (!this.isRunning) {
        return;
      }
      this.isRunning = false;
      clearInterval(this.intervalId);
      return this.updateButtons();
    }

    reset() {
      this.isRunning = false;
      if (this.intervalId) {
        clearInterval(this.intervalId);
      }
      if (this.isWorkSession) {
        this.timeLeft = this.workDuration;
      } else {
        this.timeLeft = this.breakDuration;
      }
      this.updateDisplay();
      return this.updateButtons();
    }

    completeSession() {
      this.isRunning = false;
      if (this.intervalId) {
        clearInterval(this.intervalId);
      }
      
      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
      this.playNotificationSound();
      
      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
      this.saveSession();
      
      // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ —Å–µ—Å—Å–∏–∏
      this.isWorkSession = !this.isWorkSession;
      if (this.isWorkSession) {
        this.timeLeft = this.workDuration;
      } else {
        this.timeLeft = this.breakDuration;
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—á–µ–π —Å–µ—Å—Å–∏–∏
        this.completedSessions += 1;
        this.elements.sessionCounter.textContent = this.completedSessions;
      }
      this.updateDisplay();
      this.updateButtons();
      return this.saveToStorage();
    }

    updateDisplay() {
      var formattedTime, minutes, progress, seconds, sessionText, totalTime;
      minutes = Math.floor(this.timeLeft / 60);
      seconds = this.timeLeft % 60;
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
      formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      this.elements.display.textContent = formattedTime;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–µ—Å—Å–∏–∏
      sessionText = this.isWorkSession ? '–†–∞–±–æ—á–∞—è —Å–µ—Å—Å–∏—è' : '–ü–µ—Ä–µ—Ä—ã–≤';
      this.elements.sessionType.textContent = sessionText;
      
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
      totalTime = this.isWorkSession ? this.workDuration : this.breakDuration;
      progress = ((totalTime - this.timeLeft) / totalTime) * 100;
      this.elements.progressBar.style.width = `${progress}%`;
      
      // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
      if (this.timeLeft < 60 && this.isRunning) {
        return this.elements.display.style.color = '#f44336';
      } else if (this.isWorkSession) {
        return this.elements.display.style.color = '#333';
      } else {
        return this.elements.display.style.color = '#ff9800';
      }
    }

    updateButtons() {
      this.elements.startButton.disabled = this.isRunning;
      this.elements.pauseButton.disabled = !this.isRunning;
      return this.elements.startButton.textContent = this.isRunning ? '–ó–∞–ø—É—â–µ–Ω' : '–°—Ç–∞—Ä—Ç';
    }

    playNotificationSound() {
      var error;
      try {
        this.elements.notificationSound.currentTime = 0;
        return this.elements.notificationSound.play().catch(function(error) {
          return console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', error);
        });
      } catch (error1) {
        error = error1;
        return console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞:', error);
      }
    }

    saveSession() {
      var duration, sessionData, sessionType;
      sessionType = this.isWorkSession ? 'work' : 'break';
      duration = this.isWorkSession ? this.workDuration : this.breakDuration;
      sessionData = {
        type: sessionType,
        duration: duration,
        endTime: new Date().toISOString(),
        timestamp: Date.now()
      };
      
      // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
      return this.addSessionToHistory(sessionData);
    }

    addSessionToHistory(sessionData) {
      var durationMinutes, sessionItem, time, typeText;
      sessionItem = document.createElement('div');
      sessionItem.className = `session-item session-${sessionData.type}`;
      typeText = sessionData.type === 'work' ? '–†–∞–±–æ—Ç–∞' : '–ü–µ—Ä–µ—Ä—ã–≤';
      durationMinutes = Math.floor(sessionData.duration / 60);
      time = new Date(sessionData.endTime).toLocaleTimeString('ru-RU', {
        hour: '2-digit',
        minute: '2-digit'
      });
      sessionItem.innerHTML = `<div>
    <span class="session-time">${time}</span>
    <div>${typeText}</div>
</div>
<span class="session-duration">${durationMinutes} –º–∏–Ω</span>`;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
      this.elements.sessionHistory.insertBefore(sessionItem, this.elements.sessionHistory.firstChild);
      
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 50 —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏
      if (this.elements.sessionHistory.children.length > 50) {
        return this.elements.sessionHistory.removeChild(this.elements.sessionHistory.lastChild);
      }
    }

    saveToStorage() {
      var error, storageData;
      storageData = {
        completedSessions: this.completedSessions,
        history: this.getHistoryData()
      };
      try {
        return localStorage.setItem('pomodoroData', JSON.stringify(storageData));
      } catch (error1) {
        error = error1;
        return console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ LocalStorage:', error);
      }
    }

    loadFromStorage() {
      var data, error, i, len, parsedData, ref, ref1, results, session;
      try {
        data = localStorage.getItem('pomodoroData');
        if (!data) {
          return;
        }
        parsedData = JSON.parse(data);
        this.completedSessions = (ref = parsedData.completedSessions) != null ? ref : 0;
        this.elements.sessionCounter.textContent = this.completedSessions;
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
        if (parsedData.history != null) {
          ref1 = parsedData.history;
          results = [];
          for (i = 0, len = ref1.length; i < len; i++) {
            session = ref1[i];
            results.push(this.addSessionToHistory(session));
          }
          return results;
        }
      } catch (error1) {
        error = error1;
        return console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ LocalStorage:', error);
      }
    }

    getHistoryData() {
      var durationElement, historyData, historyItems, i, item, len, timeElement, typeElement;
      historyItems = this.elements.sessionHistory.querySelectorAll('.session-item');
      historyData = [];
      for (i = 0, len = historyItems.length; i < len; i++) {
        item = historyItems[i];
        timeElement = item.querySelector('.session-time');
        typeElement = item.querySelector('div');
        durationElement = item.querySelector('.session-duration');
        if (!(timeElement && typeElement && durationElement)) {
          continue;
        }
        historyData.push({
          type: typeElement.textContent.includes('–†–∞–±–æ—Ç–∞') ? 'work' : 'break',
          duration: parseInt(durationElement.textContent) * 60,
          endTime: new Date().toDateString() + ' ' + timeElement.textContent
        });
      }
      return historyData;
    }

  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  document.addEventListener('DOMContentLoaded', function() {
    window.pomodoroTimer = new PomodoroTimer();
    
    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–±–æ—Ä–∫–µ
    console.log('üçÖ Pomodoro Tracker –∑–∞–ø—É—â–µ–Ω!');
    return console.log('–°–æ–±—Ä–∞–Ω–æ —Å CoffeeScript', Date.now());
  });

}).call(this);
